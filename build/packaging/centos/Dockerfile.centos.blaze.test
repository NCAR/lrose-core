#
# start with an image that contains all the packages needed to 
# build lrose-blaze + rpmbuilder
#

FROM centos:provisioned

# install required packages

#RUN \
#    yum install -y epel-release; \
#    yum install -y tcsh git tkcvs emacs \
#    m4 make libtool autoconf automake \
#    gcc gcc-c++ gcc-gfortran glibc-devel \
#    libX11-devel libXext-devel \
#    libpng-devel libtiff-devel zlib-devel \
#    expat-devel libcurl-devel \
#    flex-devel fftw3-devel \
#    bzip2-devel qt5-qtbase-devel \
#    hdf5-devel netcdf-devel \
#    xorg-x11-xauth xorg-x11-apps \
#    rpm-build redhat-rpm-config \
#    rpm-devel rpmdevtools

# create link for qtmake

#RUN \
#    cd /usr/bin; \
#    ln -s qmake-qt5 qmake;

# get lrose-core
    
RUN \
    cd ${HOME}/git/lrose-core; \
    git pull

# build hierarchy for rpmbuild:

RUN \
    cd ${HOME}; \
    mkdir rpmbuild; \
    cd rpmbuild; \
    mkdir BUILD RPMS SOURCES SPECS SRPMS; \
    cp ~/git/lrose-core/build/packaging/centos/test2.blaze.spec SPECS

# build the rpm
# save to mounted volume

RUN \
    cd ${HOME}/rpmbuild; \
    rpmbuild -v -bb --define "debug_package %{nil}" ./SPECS/test2.blaze.spec;

#    rsync -av RPMS /tmp-on-host
